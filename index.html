<!DOCTYPE html>

<html>

<head>

    <meta http-equiv="Content-Type" content="text/html" charset="utf-8" />
    <title>Babylon - Getting Started</title>
    <!--- link to the last version of babylon -->
    <script src="babylon.js"></script>
    <script src="http://preview.babylonjs.com/loaders/babylon.glTFFileLoader.js"></script>
    <style>
        html,
        body {
            overflow: hidden;
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
        }



        #renderCanvas {

            width: 100%;

            height: 100%;

            touch-action: none;

        }
    </style>

</head>

<body>

    <canvas id="renderCanvas"></canvas>

    <script>
        var lineCollection =[];
        var currentLine =[];
        var frameCounter = 0;
        var leftController, rightController;

        	// material
	

        window.addEventListener('DOMContentLoaded', function(){
            var canvas = document.getElementById('renderCanvas');
            
        // load the 3D engine
        var engine = new BABYLON.Engine(canvas, true);
        // createScene function that creates and return the scene
        var createScene = function () {
            // create a basic BJS Scene object
            var scene = new BABYLON.Scene(engine);

           

            VRHelper = scene.createDefaultVRExperience();
            console.log("VR up")

            VRHelper.onControllerMeshLoaded = (webVrController) => {
                console.log("controller up..")
                if (webVrController.hand === "left") {
                    console.log("left controller enabled");
                    leftController = webVrController;
                } else {
                    rightController = webVrController;
                }
            }

    
            scene.registerBeforeRender(function(){
                
                frameCounter++;
                if (frameCounter > 5) {

            
                    frameCounter = 0;  
                    if(leftController&&leftController.mesh){
                        console.log("point added");
                        console.log(leftController.mesh.absolutePosition)
                        
                        currentLine.push(new BABYLON.Vector3(
                            leftController.mesh.absolutePosition.x,
                            leftController.mesh.absolutePosition.y,
                            leftController.mesh.absolutePosition.z
                        ));
                    }
                   
                    if(currentLine.length>2){
                        console.log("ribbon created");
                        var bezier=BABYLON.Curve3.CreateQuadraticBezier(currentLine[0],currentLine[1],currentLine[2],3);
                        var ribbon = BABYLON.MeshBuilder.CreateLines("ribbon", { points: bezier.getPoints() },  scene );
                        ribbon.material = mat;
                        lineCollection.push(ribbon);
                        for(var i = 0; i<2;i++)
                            currentLine.shift();
                        console.log(currentLine.length);
                    }
                    
                    if(lineCollection.length>5){
                        lineCollection[0].dispose();
                        lineCollection.shift();
                    }

                 
            }


            });
          
            return scene;
        }
        var scene=createScene();
        var mat = new BABYLON.StandardMaterial("mat1", scene);
            mat.alpha = 1.0;
            mat.diffuseColor = new BABYLON.Color3(0.5, 0.5, 1.0);
            mat.backFaceCulling = false;
            mat.wireframe = true;
        
        engine.runRenderLoop(function(){
                     
            scene.render();
            });
        });


       
    </script>

</body>

</html>