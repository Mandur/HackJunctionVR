<!DOCTYPE html>

<html>

<head>

    <meta http-equiv="Content-Type" content="text/html" charset="utf-8" />
    <title>Babylon - Getting Started</title>
    <!--- link to the last version of babylon -->
    <script src="babylon.js"></script>
    <script src="http://preview.babylonjs.com/loaders/babylon.glTFFileLoader.js"></script>
    <style>
        html,
        body {
            overflow: hidden;
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
        }



        #renderCanvas {

            width: 100%;

            height: 100%;

            touch-action: none;

        }
    </style>

</head>

<body>

    <canvas id="renderCanvas"></canvas>

    <script>
        var lineCollection =[];
        var currentLine =[];
        var frameCounter = 0;
        var leftController, rightController;
        var colorRed, colorBlue, colorGreen, colorYellow;
        var currentColor=new BABYLON.Color3(1.0,1.0,1.0);
        	// material
	

        window.addEventListener('DOMContentLoaded', function(){
            var canvas = document.getElementById('renderCanvas');
            
        // load the 3D engine
        var engine = new BABYLON.Engine(canvas, true);
        // createScene function that creates and return the scene
        var createScene = function () {
            colorBlue = new BABYLON.Color3(0,0,1.0);
           colorGreen = new BABYLON.Color3(0,1.0,0);
           colorRed = new BABYLON.Color3(1.0,0,0);
           colorYellow = new BABYLON.Color3(1.0,1.0,0);
            // create a basic BJS Scene object 
            var scene = new BABYLON.Scene(engine);

         

            VRHelper = scene.createDefaultVRExperience();
            console.log("VR up")

            VRHelper.onControllerMeshLoaded = (webVrController) => {
                console.log("controller up..")
                if (webVrController.hand === "left") {
                    console.log("left controller enabled");
                    leftController = webVrController;
                    leftController.onPadValuesChangedObservable.add((stateObject) =>{
                        if(Math.abs(stateObject.x) >0.8){
                            currentColor=stateObject.x<0?colorBlue:colorGreen

                        }
                        else if(Math.abs(stateObject.y)>0.8){
                            currentColor=stateObject.y<0?colorRed:colorYellow
                        }
                        console.log(stateObject);
                    });
                    leftController.onMainButtonStateChangedObservable.add((stateObject) => {
                        console.log(stateObject);
                    });

                } else {
                    rightController = webVrController;
                }
            }

         
            

    
            scene.registerBeforeRender(function(){
                
                frameCounter++;
                if (frameCounter > 5) {

            
                    frameCounter = 0;  
                    if(leftController&&leftController.mesh){
                        
                        currentLine.push(new BABYLON.Vector3(
                            leftController.mesh.absolutePosition.x,
                            leftController.mesh.absolutePosition.y,
                            leftController.mesh.absolutePosition.z
                        ));
                    }
                   
                    if(currentLine.length>2){
                        var bezier=BABYLON.Curve3.CreateQuadraticBezier(currentLine[0],currentLine[1],currentLine[2],3);
                        var ribbon = BABYLON.MeshBuilder.CreateLines("ribbon", { points: bezier.getPoints() },  scene );
                        ribbon.color=currentColor;

                        lineCollection.push(ribbon);
                        for(var i = 0; i<2;i++)
                            currentLine.shift();
                    }
                    
                    if(lineCollection.length>5){
                        lineCollection[0].dispose();
                        lineCollection.shift();
                    }

                 
            }


            });
          
            return scene;
        }
        var scene=createScene();
     
        
        engine.runRenderLoop(function(){
                     
            scene.render();
            });
        });


       
    </script>

</body>

</html>